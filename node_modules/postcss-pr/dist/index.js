'use strict';

var postcss = require('postcss');
var getRootSize = require('./getRootSize');
var pxToRem = require('./pxToRem');

var defaults = {
  rootSelector: ':root',
  unit: 'pr',
  fontSize: 16
};

module.exports = postcss.plugin('postcss-pr', function (opts) {
  opts = opts || {};
  var userFontSize = opts.fontSize;
  opts = Object.assign(opts, defaults);

  return function (css) {
    var rootFontSize = userFontSize || getRootSize(css, opts) || opts.fontSize;
    var prReg = new RegExp('\\(?\\d*\\.?\\d+(px)?\\)?' + opts.unit, 'gi');

    css.replaceValues(prReg, { fast: opts.unit }, function (val) {
      return pxToRem(parseFloat(val.replace(/[()px]/gi, '')), rootFontSize);
    });
  };
});